<!-- Headings - Full width -->
<section class="text-center p-3">
  <h3 class="orange_underline">Welcome back to your LearnIt! administration dashboard, dear <%= current_user.first_name.capitalize %>.</h3>
</section>

<!-- General figures & data visualizations - Full width broken into 4 cards -->
<section class="row justify-content-around">
  
  <!-- Members' info (Users with roles "student(0)", "mentor(1)" or "admin(2)" -->
  <div class="d-flex flex-column col-2 rounded shadow g-0 border">
    <div class="d-flex justify-content-between rounded-top bg-secondary text-primary p-2">
      <div class="text-start fw-bold">
        <i class="bi bi-person-hearts fs-4"></i>
      </div>
      <div class="text-center fw-bold">
        Membres
      </div>
      <div class="text-end fw-bold fs-4 rounded bg-light px-1 opacity-75">
        <%=User.all.count%>
      </div>
    </div>
    <div class="d-flex bg-white p-2">
      <ul>
        <li><strong><%=User.where(role:0).count%></strong> étudiant(e)(s)</li>
        <li><strong><%=User.where(role:1).count%></strong> mentor(s)</li>
        <li><strong><%=User.where(role:2).count%></strong> administrateur(trice)(s)</li>
      </ul>
    </div>
    <div class="d-flex bg-white p-2">
      <p class="fw-lighter fst-italic">Représentant <strong><%= Membership.count %></strong> souscriptions.</p>
    </div>
    <div class="d-flex bg-white p-2 mb-auto">
      <p class="fw-lighter fst-italic">Dernière inscription <strong><%= User.last.created_at.strftime('%A %d %B %Y à %Hh%M') %></strong>.</p>
    </div>
    <div class="rounded-bottom p-2 list-group-item-action list-group-item-light border-top">
      <%= link_to("#", method:"get", class:"text-primary orange_underline") do %>
        Gérer les membres
        <i class="bi bi-chevron-double-right fw-bold text-secondary"></i>
      <% end %>
    </div>
  </div>

  <!-- Pedagogical objects' info (Themes, Chapters, Courses, Quizzes...) -->
  <div class="d-flex flex-column col-2 rounded shadow g-0 border">
    <div class="d-flex justify-content-between rounded-top bg-primary text-secondary p-2">
      <div class="text-start fw-bold">
        <i class="bi bi-mortarboard-fill fs-4"></i>
      </div>
      <div class="text-center fw-bold">
        Cursus
      </div>
      <div class="text-end fw-bold fs-4 rounded bg-light px-1 opacity-75">
        <%= Theme.count + Chapter.count + Course.count + Quiz.count + QuestionAnswer.count %>
      </div>
    </div>
    <div class="d-flex bg-white mb-auto p-2">
      <ul>
        <li><strong><%=Theme.count%></strong> thème(s)</li>
        <li><strong><%=Chapter.count%></strong> chapitre(s)</li>
        <li><strong><%=Course.count%></strong> cours</li>
        <li><strong><%=Quiz.count%></strong> questionnaire(s)</li>
        <li><strong><%=QuestionAnswer.count%></strong> questions/réponses</li>
      </ul>
    </div>
    <div class="rounded-bottom p-2 list-group-item-action list-group-item-light border-top">
      <%= link_to("#", method:"get", class:"text-primary orange_underline") do %>
        Gérer les thèmes, chapitres...
        <i class="bi bi-chevron-double-right fw-bold text-secondary"></i>
      <% end %>
    </div>
  </div>

  <!-- Consolidated completion info by themes / chapters / courses -->
  <div class="d-flex flex-column col-2 rounded shadow g-0 border">
    <div class="d-flex justify-content-between rounded-top bg-secondary text-primary p-2">
      <div class="text-start fw-bold">
        <i class="bi bi-bar-chart-line-fill"></i>
      </div>
      <div class="text-center fw-bold">
        Progression
      </div>
      <div class="text-end fw-bold fs-4 rounded bg-light px-1 opacity-75">
        <%= (UserThemeSeason.sum(:completion_rate) + UserThemeSeasonChapter.sum(:completion_rate) + UtscCourse.where(completed:true).count*100) / (UserThemeSeason.count + UserThemeSeasonChapter.count + UtscCourse.count) %><span class="fst-italic fs-6">%</span>
      </div>
    </div>
    <div class="d-flex bg-white p-2">
      <ul>
        <li><strong><%= (UserThemeSeason.sum(:completion_rate).to_f / UserThemeSeason.count).round(2) %></strong>% de thèmes complétés</li>
        <li><strong><%= (UserThemeSeasonChapter.sum(:completion_rate).to_f / UserThemeSeasonChapter.count).round(2) %></strong>% de chapitres complétés</li>
        <li><strong><%= ((UtscCourse.where(completed:true).count.to_f * 100) / UtscCourse.count).round(2) %></strong>% de cours complétés</li>
      </ul>
    </div>
    <div class="d-flex bg-white p-2 mb-auto">
      <p class="fw-lighter fst-italic">Et un taux croissant de réussite sur les <strong><%= Season.count %></strong> dernières saisons.</p>
    </div>
    <div class="rounded-bottom p-2 list-group-item-action list-group-item-light border-top">
      <%= link_to("#", method:"get", class:"text-primary orange_underline") do %>
        Gérer les résultats
        <i class="bi bi-chevron-double-right fw-bold text-secondary"></i>
      <% end %>
    </div>
  </div>

  <!-- Groups' infos -->
  <div class="d-flex flex-column col-2 rounded shadow g-0 border">
    <div class="d-flex justify-content-between rounded-top bg-primary text-secondary p-2">
      <div class="text-start fw-bold">
        <i class="bi bi-people-fill fs-5"></i><i class="bi bi-people-fill fs-4 ms-n1"></i>
      </div>
      <div class="text-center fw-bold">
        Groups
      </div>
      <div class="text-end fw-bold fs-4 rounded bg-light px-1 opacity-75">
        <%= Group.count %>
      </div>
    </div>
    <div class="d-flex bg-white mb-auto p-2">
      <ul>
        <li><strong><%=Group.count%></strong> groupes au total</li>
        <% 
          my_open_seasons = Season.where("start_date <= ? and end_date > ?", Time.now(), Time.now()) 
          my_closed_seasons = Season.where("end_date <= ?", Time.now())
          my_future_seasons = Season.where("start_date > ?", Time.now())
        %>
        <li><strong><%=Group.where(season_id: my_open_seasons).count%></strong> groupes actifs</li>
        <li><strong><%=my_open_seasons.count%></strong> saisons en cours</li>
        <li><strong><%=my_closed_seasons.count%></strong> saisons closes</li>
        <li><strong><%=my_future_seasons.count%></strong> saisons à venir</li>
      </ul>
    </div>
    <div class="rounded-bottom p-2 list-group-item-action list-group-item-light border-top">
      <%= link_to("#", method:"get", class:"text-primary orange_underline") do %>
        Gérer les groupes
        <i class="bi bi-chevron-double-right fw-bold text-secondary"></i>
      <% end %>
    </div>
  </div>

  <!-- Extract of the 5-10 most recent Private Messages -->
  <!-- [BONUS] Hence still faking it as of March 28 but should / could be part of LearnIt! in the future -->
  <div class="d-flex flex-column col-3 rounded shadow g-0 border border">
    <div class="d-flex justify-content-between rounded-top bg-secondary text-primary p-2">
      <div class="text-start fw-bold">
        <i class="bi bi-chat-right-text fs-4"></i>
      </div>
      <div class="text-center fw-bold">
        Messages [BONUS]
      </div>
      <div class="text-end fw-bold fs-4 rounded bg-light px-1 opacity-75">
        <%= "777" %>
      </div>
    </div>
    <div class="d-flex bg-white p-2 mb-auto">
      <table class="table table-hover table-stripe small">
        <thead>
          <tr>
            <th><i class="bi bi-chevron-double-down text-secondary"></i> De :</th>
            <th><i class="bi bi-chevron-double-down text-secondary"></i> A :</th>
            <th><i class="bi bi-chevron-double-down text-secondary"></i> Date :</th>
            <th><i class="bi bi-chevron-double-down text-secondary"></i> Contenu :</th>
          </tr>
        <thead>
        <tbody>
          <tr>
            <td><%=User.first.first_name%></td>
            <td><%=User.last.first_name%></td>
            <td>28 mars 2022</td>
            <td>Bla bla bla</td>
          </tr>
          <tr>
            <td><%=User.all[1].first_name%></td>
            <td><%=User.all[2].first_name%></td>
            <td>27 mars 2022</td>
            <td>This is just a test</td>
          </tr>
          <tr>
            <td><%=User.all[2].first_name%></td>
            <td><%=User.all[3].first_name%></td>
            <td>20 mars 2022</td>
            <td>Another question</td>
          </tr>
          <tr>
            <td><%=User.all[5].first_name%></td>
            <td><%=User.all[3].first_name%></td>
            <td>19 mars 2022</td>
            <td>Still here?</td>
          </tr>
        <tbody>
      </table>
    </div>
    <div class="rounded-bottom p-2 list-group-item-action list-group-item-light border-top">
      <%= link_to("#", method:"get", class:"text-primary orange_underline") do %>
        Gérer les messages
        <i class="bi bi-chevron-double-right fw-bold text-secondary"></i>
      <% end %>
    </div>
  </div>

</section>

<hr/>

<!-- Access to extracts of LearnIt! data - Full width -->
<section class="row justify-content-around">
  <!-- Users' list -->
  <div class="col-5 rounded bg-warning py-5" >
    Encart qui recevra une liste d'utilisateurs (par ex.)
  </div>  
  <!-- Themes' list-->
  <div class="col-5 rounded bg-success py-5">
    Encart qui recevra une liste de cours (par ex.)
  </div>
</section>

